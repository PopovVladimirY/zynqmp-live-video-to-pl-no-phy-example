# Xilinx DP video example modified to enable Live Video output with no PHY connected.

This project is derived from dpdma **standalone** driver example and modified to run with no Display Port PHY present.
To make this example practical, the Live Video output of Display port shall be connected to something useful in FPGA. For instance, a custom LCD screen interface implemented in VHDL or an HDMI/SDI TX IP. The VHDL design is outside of the scope of this exercise. Which is focusing on a smallest software setup required for delivering DP Live Video output to FPGA in **NO_PHY** mode. The instructions below are for Cortex A53 in standalone mode. However, this approach  will work for Cortext R5 as well.

>IMPORTANT: This example will need a modified BSP **dppsu** driver. See instructions below.

## Setting up

Steps to set up VITIS project:

1. Launch VITIS and create new Application Project. Select workspace location when prompted.
2. For platform configuration, select an .XSA file matching your hardware platform.
3. Select "Hello world" sample application to complete project creation.

Configuring BSP for DP example:

1. In VITIS project panel, double-click platform.spr to open BSP configuration panel.
2. In the BSP panel, select **"standalone on psu_cortex_a53/Board Support Package"**
3. Go to **"Modify BSP Settings"** and at Overview level check libraries **xilffs**, **xilpm**, and **xilsecure**.
4. Then, in **drivers** locate **psu_dp** and change driver from **avbuf** to **dppsu**.
5. Click OK.
6. In BSP pannel, expand **Pereferial Drivers** and find **dpdma** driver.
7. Click on **Import Examples**, check all and click OK. A new system project with **xdppsu_video_example** will be add to workspace.

>IMPORTANT: Build the platform project **before** the next step! Because during the first build Vitis will overwrite its content from Xilinx SDK, updating the content of **cortexa53_0** folder. 

## Updating the example project and BSP libraries

1. Remove the video example source code files from **src** folder and clone this repository into it.
2. Replace content of **psu_cortex53_0** folder inside the platform project with the modifed version. In the platform project, remove the content of **cortexa53_0** folder and clone following repository into it.

    https://github.com/PopovVladimirY/zynqmp-display-port-no-phy-example.git

Build example system project. It will compile the BSP as well and will create the boot package to use with J-TAG debugger.

## Running application on a hardware via J-TAG.

To run and debug the application, the J-TAG shall be connected to the hardware platform.

To configure debugging session:

1. Right-click on example system project and select **Debug As** from pop-up menu, then **Debugging Configurations...**
2. In the opened dialog left pannel, double-click on **System Project Debug**.
3. When dialog opens, all is set. Click **Debug**, debug session will begin. The FPGA will be loaded and application start. The application will break on the entry of **main()**.

To start debug session again, click debug button at toolbar. The last choice of system project debug configuration will be launched. Otherwise, select from the debug button drop down list.

## Using Vivado for VHDL debugging with VITIS

The VITIS and VIVADO can be used together to debug a design. It is required, that VITIS is using .XSA generated by VIVADO project opened for debugging. It means, the bitstream shall be generated localy by the VIVADO and hardware exported to .XSA, including the bitstream, to be used with VITIS. The ILA shall be integrated into FPGA design to make debugging possible. If these requirements are met:

1. Start debugging session in VITIS, wait for FPGA to be programmed and software debugger break in at the beginning of **main()**.
2. Open VIVADO project and go to **PROGRAM AND DEBUG** section in the left panel.
3. Expand **Open Hardware Manager** and click on **Open Target**
4. Select **Auto Connect**, the ILA window will open with one tab per ILA instance. 
5. You are all set for debugging.

